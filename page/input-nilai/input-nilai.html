<!DOCTYPE html>
<html lang="en">
  <head>
    <!---------x-------------------x--------------------x------------------- Link CSS ---------x-------------------x--------------------x------------------->
    <link rel="stylesheet" href="/css/absensi.css" />
    <!---------x-------------------x--------------------x------------------- link google icons ---------x-------------------x--------------------x------------------->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
    <!---------x-------------------x--------------------x------------------- link google font ---------x-------------------x--------------------x------------------->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto+Slab:wght@100..900&display=swap"
      rel="stylesheet"
    />
    <!---------x-------------------x--------------------x------------------- Feather Icons ---------x-------------------x--------------------x------------------->
    <script src="https://unpkg.com/feather-icons"></script>
    <!---------x-------------------x--------------------x------------------- Batas Link ---------x-------------------x--------------------x------------------->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SMP N 31 Bandung</title>
  </head>
  <!---------x-------------------x--------------------x------------------- Body Mulai ---------x-------------------x--------------------x------------------->
  <!---------x-------------------x--------------------x------------------- Navbar Mulai ---------x-------------------x--------------------x------------------->
  <body>
    <nav class="navbar">
      <div class="logo-tutwurihandayani"></div>
      <a href="#" class="tulisan-tengah">BERANDA</a>
      <a href="#" id="menu"><i data-feather="menu"></i></a>
      <div class="navbar-navigasi">
        <a href="/index.html">BERANDA</a>
        <a href="/page/input-nilai/input-nilai.html">INPUT</a>
        <a href="/page/absensi/absensi-siswa.html">ABSENSI</a>
        <a href="#">PENGATURAN</a>
        <a href="#">TERIMA ADUAN</a>
        <a href="#">ABSENSI KELAS</a>
        <a href="#">LAPORAN</a>
      </div>
    </nav>
    <!---------x-------------------x--------------------x------------------- Navbar Selesai ---------x-------------------x--------------------x------------------->
    <!---------x-------------------x--------------------x------------------- section mulai ---------x-------------------x--------------------x------------------->
    <section class="konten-tengah">
      <div class="main-content">
        <main class="table" id="customers_table">
          <section class="table__header">
            <h1>Daftar Hadir</h1>
            <div class="input-group">
              <input type="search" placeholder="Search Data..." />
              <img src="/images/search.png" alt="" />
            </div>
            <div class="export__file">
              <label
                for="export-file"
                class="export__file-btn"
                title="Export File"
              ></label>
              <input type="checkbox" id="export-file" />
              <div class="export__file-options">
                <label>Export As &nbsp; &#10140;</label>
                <label for="export-file" id="toPDF"
                  >PDF <img src="/images/pdf.png" alt=""
                /></label>
                <label for="export-file" id="toJSON"
                  >JSON <img src="/images/json.png" alt=""
                /></label>
                <label for="export-file" id="toCSV"
                  >CSV <img src="/images/csv.png" alt=""
                /></label>
                <label for="export-file" id="toEXCEL"
                  >EXCEL <img src="/images/excel.png" alt=""
                /></label>
              </div>
            </div>
          </section>
          <section class="table__body">
            <table>
              <thead>
                <tr>
                  <th>Id <span class="icon-arrow">&UpArrow;</span></th>
                  <th>Nama Siswa <span class="icon-arrow">&UpArrow;</span></th>
                  <th>Kelas <span class="icon-arrow">&UpArrow;</span></th>
                  <th>Nilai<span class="icon-arrow">&UpArrow;</span></th>
                  <th>Status <span class="icon-arrow">&UpArrow;</span></th>
                  <th>Action<span class="icon-arrow">&UpArrow;</span></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>1</td>
                  <td><img src="/images/Zinzu Chan Lee.jpg" alt="" />syamsa</td>
                  <td>XI TKJ 1</td>
                  <td>90</td>
                  <td>
                    <p class="status delivered">tuntas</p>
                  </td>
                  <td>
                    <strong>
                      <a href="">Edit</a>
                      <a href="">Hapus</a>
                    </strong>
                  </td>
                </tr>
                <tr>
                  <td>2</td>
                  <td>
                    <img src="/images/Alson GC.jpg" alt="" />satria mahatir
                  </td>
                  <td>XI TKJ 1</td>
                  <td>65</td>
                  <td>
                    <p class="status cancelled">tidak tuntas</p>
                  </td>
                  <td>
                    <strong>
                      <a href="">Edit</a>
                      <a href="">Hapus</a>
                    </strong>
                  </td>
                </tr>
                <tr>
                  <td>3</td>
                  <td><img src="/images/Sonal Gharti.jpg" alt="" /> yusuf</td>
                  <td>XI TKJ 2</td>
                  <td>80</td>
                  <td>
                    <p class="status shipped">remedi</p>
                  </td>
                  <td>
                    <strong>
                      <a href="">Edit</a>
                      <a href="">Hapus</a>
                    </strong>
                  </td>
                </tr>
                <tr>
                  <td>4</td>
                  <td><img src="/images/Alson GC.jpg" alt="" /> arka</td>
                  <td>XI TKJ 1</td>
                  <td>88</td>
                  <td>
                    <p class="status delivered">tuntas</p>
                  </td>
                  <td>
                    <strong>
                      <a href="">Edit</a>
                      <a href="">Hapus</a>
                    </strong>
                  </td>
                </tr>
                <tr>
                  <td>5</td>
                  <td><img src="/images/Sarita Limbu.jpg" alt="" /> habib</td>
                  <td>XI TKJ 1</td>
                  <td>90</td>
                  <td>
                    <p class="status delivered">tuntas</p>
                  </td>
                  <td><strong>
                    <a href="">Edit</a>
                    <a href="">Hapus</a>
                  </strong></td>
                </tr>
              </tbody>
            </table>
          </section>
        </main>
        <script src="js/absensi/absensi.js"></script>
      </div>
    </section>
    <!---------x-------------------x--------------------x------------------- section selesai ---------x-------------------x--------------------x------------------->

    <!-- scripts Feather Icons -->
    <script>
      feather.replace();
    </script>
    <!--  -->
    <script src="/js/script.js"></script>
    <!--  -->
    <!--  -->
    <script>
      const search = document.querySelector(".input-group input"),
        table_rows = document.querySelectorAll("tbody tr"),
        table_headings = document.querySelectorAll("thead th");

      // 1. Searching for specific data of HTML table
      search.addEventListener("input", searchTable);

      function searchTable() {
        table_rows.forEach((row, i) => {
          let table_data = row.textContent.toLowerCase(),
            search_data = search.value.toLowerCase();

          row.classList.toggle("hide", table_data.indexOf(search_data) < 0);
          row.style.setProperty("--delay", i / 25 + "s");
        });

        document
          .querySelectorAll("tbody tr:not(.hide)")
          .forEach((visible_row, i) => {
            visible_row.style.backgroundColor =
              i % 2 == 0 ? "transparent" : "#0000000b";
          });
      }

      // 2. Sorting | Ordering data of HTML table

      table_headings.forEach((head, i) => {
        let sort_asc = true;
        head.onclick = () => {
          table_headings.forEach((head) => head.classList.remove("active"));
          head.classList.add("active");

          document
            .querySelectorAll("td")
            .forEach((td) => td.classList.remove("active"));
          table_rows.forEach((row) => {
            row.querySelectorAll("td")[i].classList.add("active");
          });

          head.classList.toggle("asc", sort_asc);
          sort_asc = head.classList.contains("asc") ? false : true;

          sortTable(i, sort_asc);
        };
      });

      function sortTable(column, sort_asc) {
        [...table_rows]
          .sort((a, b) => {
            let first_row = a
                .querySelectorAll("td")
                [column].textContent.toLowerCase(),
              second_row = b
                .querySelectorAll("td")
                [column].textContent.toLowerCase();

            return sort_asc
              ? first_row < second_row
                ? 1
                : -1
              : first_row < second_row
              ? -1
              : 1;
          })
          .map((sorted_row) =>
            document.querySelector("tbody").appendChild(sorted_row)
          );
      }

      // 3. Converting HTML table to PDF

      const pdf_btn = document.querySelector("#toPDF");
      const customers_table = document.querySelector("#customers_table");

      const toPDF = function (customers_table) {
        const html_code = `
  <!DOCTYPE html>
  <link rel="stylesheet" type="text/css" href="style.css">
  <main class="table" id="customers_table">${customers_table.innerHTML}</main>`;

        const new_window = window.open();
        new_window.document.write(html_code);

        setTimeout(() => {
          new_window.print();
          new_window.close();
        }, 400);
      };

      pdf_btn.onclick = () => {
        toPDF(customers_table);
      };

      // 4. Converting HTML table to JSON

      const json_btn = document.querySelector("#toJSON");

      const toJSON = function (table) {
        let table_data = [],
          t_head = [],
          t_headings = table.querySelectorAll("th"),
          t_rows = table.querySelectorAll("tbody tr");

        for (let t_heading of t_headings) {
          let actual_head = t_heading.textContent.trim().split(" ");

          t_head.push(
            actual_head
              .splice(0, actual_head.length - 1)
              .join(" ")
              .toLowerCase()
          );
        }

        t_rows.forEach((row) => {
          const row_object = {},
            t_cells = row.querySelectorAll("td");

          t_cells.forEach((t_cell, cell_index) => {
            const img = t_cell.querySelector("img");
            if (img) {
              row_object["customer image"] = decodeURIComponent(img.src);
            }
            row_object[t_head[cell_index]] = t_cell.textContent.trim();
          });
          table_data.push(row_object);
        });

        return JSON.stringify(table_data, null, 4);
      };

      json_btn.onclick = () => {
        const json = toJSON(customers_table);
        downloadFile(json, "json");
      };

      // 5. Converting HTML table to CSV File

      const csv_btn = document.querySelector("#toCSV");

      const toCSV = function (table) {
        // Code For SIMPLE TABLE
        // const t_rows = table.querySelectorAll('tr');
        // return [...t_rows].map(row => {
        //     const cells = row.querySelectorAll('th, td');
        //     return [...cells].map(cell => cell.textContent.trim()).join(',');
        // }).join('\n');

        const t_heads = table.querySelectorAll("th"),
          tbody_rows = table.querySelectorAll("tbody tr");

        const headings =
          [...t_heads]
            .map((head) => {
              let actual_head = head.textContent.trim().split(" ");
              return actual_head
                .splice(0, actual_head.length - 1)
                .join(" ")
                .toLowerCase();
            })
            .join(",") +
          "," +
          "image name";

        const table_data = [...tbody_rows]
          .map((row) => {
            const cells = row.querySelectorAll("td"),
              img = decodeURIComponent(row.querySelector("img").src),
              data_without_img = [...cells]
                .map((cell) => cell.textContent.replace(/,/g, ".").trim())
                .join(",");

            return data_without_img + "," + img;
          })
          .join("\n");

        return headings + "\n" + table_data;
      };

      csv_btn.onclick = () => {
        const csv = toCSV(customers_table);
        downloadFile(csv, "csv", "customer orders");
      };

      // 6. Converting HTML table to EXCEL File

      const excel_btn = document.querySelector("#toEXCEL");

      const toExcel = function (table) {
        // Code For SIMPLE TABLE
        // const t_rows = table.querySelectorAll('tr');
        // return [...t_rows].map(row => {
        //     const cells = row.querySelectorAll('th, td');
        //     return [...cells].map(cell => cell.textContent.trim()).join('\t');
        // }).join('\n');

        const t_heads = table.querySelectorAll("th"),
          tbody_rows = table.querySelectorAll("tbody tr");

        const headings =
          [...t_heads]
            .map((head) => {
              let actual_head = head.textContent.trim().split(" ");
              return actual_head
                .splice(0, actual_head.length - 1)
                .join(" ")
                .toLowerCase();
            })
            .join("\t") +
          "\t" +
          "image name";

        const table_data = [...tbody_rows]
          .map((row) => {
            const cells = row.querySelectorAll("td"),
              img = decodeURIComponent(row.querySelector("img").src),
              data_without_img = [...cells]
                .map((cell) => cell.textContent.trim())
                .join("\t");

            return data_without_img + "\t" + img;
          })
          .join("\n");

        return headings + "\n" + table_data;
      };

      excel_btn.onclick = () => {
        const excel = toExcel(customers_table);
        downloadFile(excel, "excel");
      };

      const downloadFile = function (data, fileType, fileName = "") {
        const a = document.createElement("a");
        a.download = fileName;
        const mime_types = {
          json: "application/json",
          csv: "text/csv",
          excel:
            "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
        };
        a.href = `
      data:${mime_types[fileType]};charset=utf-8,${encodeURIComponent(data)}
  `;
        document.body.appendChild(a);
        a.click();
        a.remove();
      };
    </script>

    <!-- Batas comment -->
  </body>
  <!---------x-------------------x--------------------x------------------- Body Selesai ---------x-------------------x--------------------x------------------->
</html>
